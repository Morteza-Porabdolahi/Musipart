const audioElem=document.querySelector(".music-player__audio"),playerPlayBtn=document.querySelector(".control:nth-child(2)"),playerImage=document.querySelector(".image__music-img"),musicPlayerContainer=document.querySelector(".container__music-player"),volumeSlider=document.querySelector(".volume-range"),repeatSong=document.querySelector(".setting:nth-child(2)"),qualityBtn=document.querySelector(".setting:nth-child(3)"),progressBar=document.querySelector(".music-player__progress"),musicName=document.querySelector(".controls-container__description > .informations__music-name"),artistsName=document.querySelector(".controls-container__description > .informations__music-artist");let currentTime,isPlaying,isHD=!1,defaultVolume=.2;async function getMusic(e){const t=`https://haji-api.ir/music?q=info&t=${e}`;try{showAlert("loading","Loading...");const e=await fetch(t);return e.json()}catch(e){e&&(showAlert("error","An error occured !"),setTimeout(hideAlert,1e3))}}async function playEntireMusic(e,t){musicPlayerContainer.style.display="none",pauseMusic(),window.currentMusic=await getMusic(t),audioElem.src=currentMusic.audio.medium.url,audioElem.addEventListener("canplay",playTheAudioWhenReady),audioElem.addEventListener("error",handleAudioElemErrors)}function handleAudioElemErrors(){hideAlert(),showAlert("error","Something went Wrong!"),setTimeout(hideAlert,1e3)}function playTheAudioWhenReady(){setRequirementEvents(),playerImage.src=currentMusic.image.thumbnail_small.url,playerImage.alt=currentMusic.title,musicName.textContent=currentMusic.title,artistsName.textContent=currentMusic.artists.map((e=>e.fullName)),audioElem.volume=defaultVolume,musicPlayerContainer.style.display="block",hideAlert(),playMusic()}function setRequirementEvents(){volumeSlider.addEventListener("input",handleAudioVolume),repeatSong.addEventListener("click",handleReapetOrNot),qualityBtn.addEventListener("click",handleAudioQuality),playerPlayBtn.addEventListener("click",handlePlayerPauseOrClick),audioElem.addEventListener("timeupdate",handleProgressBar),audioElem.addEventListener("ended",resetProgressBarWidth),progressBar.addEventListener("click",setCurrentTime)}function handleProgressBar(){musicPlayerContainer.style.setProperty("--progress-width",audioElem.currentTime/audioElem.duration*100+"%")}function resetProgressBarWidth(){pauseMusic(),musicPlayerContainer.style.setProperty("--progress-width","0")}function handlePlayerPauseOrClick(){isPlaying?pauseMusic():playMusic()}function playMusic(){isPlaying=!0,playerPlayBtn.firstElementChild.src="/assets/icons/pause-mini-line.svg",audioElem.play()}function pauseMusic(){isPlaying=!1,playerPlayBtn.firstElementChild.src="/assets/icons/play-mini-line.svg",audioElem.pause()}function handleReapetOrNot(){audioElem.loop?audioElem.loop=!1:audioElem.loop=!0,showAlert("done","Repeat Mode is Now "+(audioElem.loop?"Enabled":"Disabled")),setTimeout(hideAlert,1e3)}function handleAudioVolume(e){defaultVolume=e.target.value/100,audioElem.volume=defaultVolume}function handleAudioQuality(){currentTime=audioElem.currentTime,isHD=!isHD,resetProgressBarWidth(),showAlert("done","HD Mode is Now "+(isHD?"Enabled":"Disabled")),setTimeout(hideAlert,1e3),audioElem.src=isHD?currentMusic.audio.high.url:currentMusic.audio.medium.url,audioElem.currentTime=currentTime,playMusic()}function setCurrentTime(e){const t=e.offsetX/e.target.offsetWidth*100;musicPlayerContainer.style.setProperty("--progress-width",`${t}%`),audioElem.currentTime=t/100*audioElem.duration}
